<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FullGaming</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo_solo.png') }}">
    <link rel="stylesheet"  href="{{ url_for('static', filename='css/index.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /* ================================================ */
        /*  PANEL GESTI√ìN PRODUCTOS ‚Äî TEMA OSCURO           */
        /* ================================================ */
        .gestion-productos-panel {
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1f4f 100%) !important;
            border: 1px solid rgba(106, 68, 242, 0.25) !important;
            border-radius: 16px !important;
            padding: 30px 35px !important;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.35), 0 0 40px rgba(106, 68, 242, 0.08) !important;
        }
        .gestion-productos-panel h1 {
            color: #fff !important;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(106, 68, 242, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .gestion-productos-panel h1::before {
            content: 'üì¶';
            font-size: 26px;
        }

        /* ===== STATS R√ÅPIDOS ===== */
        .stats-row {
            display: flex;
            gap: 14px;
            margin-bottom: 22px;
            flex-wrap: wrap;
        }
        .stat-card {
            flex: 1;
            min-width: 140px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(106, 68, 242, 0.15);
            border-radius: 12px;
            padding: 16px 18px;
            text-align: center;
            transition: border-color 0.2s;
        }
        .stat-card:hover {
            border-color: rgba(106, 68, 242, 0.35);
        }
        .stat-card .stat-num {
            font-size: 26px;
            font-weight: 800;
            color: #fff;
            line-height: 1;
            margin-bottom: 4px;
        }
        .stat-card .stat-label {
            font-size: 11px;
            color: #8b82d4;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        .stat-card.stock-ok .stat-num { color: #2ecc71; }
        .stat-card.stock-bajo .stat-num { color: #f39c12; }
        .stat-card.stock-agotado .stat-num { color: #e74c3c; }

        /* ===== FILTROS ===== */
        .filtros-bar-prod {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 14px 18px;
            background: rgba(106, 68, 242, 0.06);
            border: 1px solid rgba(106, 68, 242, 0.15);
            border-radius: 12px;
        }
        .filtros-bar-prod .filtro-label {
            display: flex;
            align-items: center;
            color: #8b82d4;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            margin-right: 6px;
            white-space: nowrap;
        }
        .filtro-chip-prod {
            padding: 5px 14px;
            border-radius: 20px;
            border: 1px solid rgba(106, 68, 242, 0.25);
            background: rgba(255, 255, 255, 0.04);
            color: #bbb;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            user-select: none;
        }
        .filtro-chip-prod:hover {
            background: rgba(106, 68, 242, 0.12);
            border-color: rgba(106, 68, 242, 0.4);
            color: #d4d0f0;
        }
        .filtro-chip-prod.active {
            background: linear-gradient(135deg, #6A44F2, #3C308C);
            border-color: #6A44F2;
            color: #fff;
            box-shadow: 0 4px 14px rgba(106, 68, 242, 0.3);
        }
        .filtro-chip-prod .chip-count {
            display: inline-block;
            margin-left: 6px;
            background: rgba(255, 255, 255, 0.15);
            padding: 1px 7px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            min-width: 18px;
            text-align: center;
        }
        .filtro-chip-prod.active .chip-count {
            background: rgba(255, 255, 255, 0.25);
        }
        .filtros-sin-resultados-prod {
            text-align: center;
            color: #888;
            padding: 30px 0;
            font-size: 14px;
            display: none;
        }

        /* ===== BUSCADOR INLINE ===== */
        .busqueda-inline {
            margin-left: auto;
            position: relative;
        }
        .busqueda-inline input {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(106, 68, 242, 0.25);
            border-radius: 20px;
            padding: 6px 14px 6px 32px;
            color: #d4d0f0;
            font-size: 13px;
            width: 200px;
            transition: all 0.2s;
            outline: none;
        }
        .busqueda-inline input::placeholder { color: #777; }
        .busqueda-inline input:focus {
            border-color: #6A44F2;
            box-shadow: 0 0 0 2px rgba(106, 68, 242, 0.15);
            width: 240px;
        }
        .busqueda-inline::before {
            content: 'üîç';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 13px;
            pointer-events: none;
        }

        /* ===== TABLA ===== */
        .gestion-productos-panel .table {
            --bs-table-bg: transparent !important;
            --bs-table-striped-bg: rgba(106, 68, 242, 0.04) !important;
            --bs-table-hover-bg: rgba(106, 68, 242, 0.1) !important;
            --bs-table-border-color: rgba(106, 68, 242, 0.1) !important;
            --bs-table-color: #d4d0f0 !important;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 0;
        }
        .gestion-productos-panel .table thead {
            background: rgba(106, 68, 242, 0.12) !important;
        }
        .gestion-productos-panel .table thead th {
            background: transparent !important;
            color: #B5B3F2 !important;
            font-family: 'Horizon', sans-serif;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 14px 14px !important;
            border-bottom: 2px solid rgba(106, 68, 242, 0.2) !important;
            white-space: nowrap;
        }
        .gestion-productos-panel .table thead th:first-child { border-radius: 10px 0 0 0; }
        .gestion-productos-panel .table thead th:last-child { border-radius: 0 10px 0 0; }
        .gestion-productos-panel .table tbody td {
            background: transparent !important;
            color: #d4d0f0 !important;
            padding: 12px 14px !important;
            vertical-align: middle !important;
            border-bottom: 1px solid rgba(106, 68, 242, 0.06) !important;
            font-size: 14px;
            transition: background 0.2s ease;
        }
        .gestion-productos-panel .table tbody tr {
            transition: all 0.2s ease;
        }
        .gestion-productos-panel .table tbody tr:hover td {
            background: rgba(106, 68, 242, 0.08) !important;
        }
        .gestion-productos-panel .table tbody tr:last-child td {
            border-bottom: none !important;
        }

        /* Nombre de producto */
        .prod-nombre {
            font-weight: 600;
            color: #fff !important;
            font-size: 14px;
        }
        /* Categor√≠a badge */
        .badge-cat {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(106, 68, 242, 0.15);
            color: #B5B3F2;
            border: 1px solid rgba(106, 68, 242, 0.2);
            letter-spacing: 0.3px;
        }
        /* Precio */
        .precio-cell {
            font-weight: 700;
            color: #fff !important;
            font-size: 15px;
        }
        .precio-cell::before { content: '$'; color: #8b82d4; }

        /* ===== BADGES DE STOCK ===== */
        .badge-stock {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        .badge-stock.en-stock {
            background: rgba(46, 204, 113, 0.15);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.2);
        }
        .badge-stock.bajo-stock {
            background: rgba(243, 156, 18, 0.15);
            color: #f39c12;
            border: 1px solid rgba(243, 156, 18, 0.2);
        }
        .badge-stock.agotado {
            background: rgba(231, 76, 60, 0.15);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.2);
        }
        .badge-stock .stock-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            display: inline-block;
        }
        .badge-stock.en-stock .stock-dot { background: #2ecc71; }
        .badge-stock.bajo-stock .stock-dot { background: #f39c12; }
        .badge-stock.agotado .stock-dot { background: #e74c3c; }

        /* ===== ACCIONES ===== */
        .acciones-prod {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        .btn-acc {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-decoration: none;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            white-space: nowrap;
        }
        .btn-acc img { width: 14px; height: auto; filter: brightness(2); }
        .btn-acc.acc-detalle {
            background: rgba(255, 215, 0, 0.12);
            color: #FFD700;
            border: 1px solid rgba(255, 215, 0, 0.25);
        }
        .btn-acc.acc-detalle:hover {
            background: rgba(255, 215, 0, 0.22);
            transform: translateY(-1px);
        }
        .btn-acc.acc-editar {
            background: rgba(106, 68, 242, 0.15);
            color: #B5B3F2;
            border: 1px solid rgba(106, 68, 242, 0.25);
        }
        .btn-acc.acc-editar:hover {
            background: rgba(106, 68, 242, 0.3);
            transform: translateY(-1px);
        }
        .btn-acc.acc-eliminar {
            background: rgba(231, 76, 60, 0.12);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.25);
        }
        .btn-acc.acc-eliminar:hover {
            background: rgba(231, 76, 60, 0.25);
            transform: translateY(-1px);
        }

        /* ===== BOT√ìN AGREGAR ===== */
        .btn-agregar-prod {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 9px 18px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            color: #fff;
            background: linear-gradient(135deg, #6A44F2, #3C308C);
            transition: all 0.25s ease;
            margin-bottom: 20px;
            border: none;
            box-shadow: 0 4px 15px rgba(106, 68, 242, 0.25);
        }
        .btn-agregar-prod:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(106, 68, 242, 0.4);
            color: #fff;
        }
        .btn-agregar-prod img { width: 18px; height: auto; filter: brightness(2); }

        /* ===== MODAL DETALLE ===== */
        .modal-overlay-detalle {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        .modal-overlay-detalle.active {
            display: flex;
            animation: fadeInDet 0.3s ease-in;
        }
        @keyframes fadeInDet {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUpDet {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-detalle-body {
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1f4f 100%);
            border: 1px solid rgba(106, 68, 242, 0.3);
            border-radius: 16px;
            padding: 30px;
            max-width: 480px;
            width: 95%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 60px rgba(106, 68, 242, 0.2);
            animation: slideUpDet 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            color: white;
            position: relative;
        }
        .modal-detalle-body .close-btn {
            position: absolute;
            top: 12px; right: 18px;
            background: none; border: none;
            color: #bbb; font-size: 22px;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-detalle-body .close-btn:hover { color: #fff; }
        .modal-detalle-body h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(106, 68, 242, 0.25);
            color: #fff;
        }
        .det-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 11px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }
        .det-row:last-child { border-bottom: none; }
        .det-row .det-label {
            color: #8b82d4;
            font-size: 13px;
            font-weight: 600;
        }
        .det-row .det-value {
            color: #fff;
            font-weight: 700;
            font-size: 14px;
        }
        .det-row .det-value.positivo { color: #2ecc71; }
        .det-row .det-value.neutro { color: #f39c12; }
        .det-row .det-value.negativo { color: #e74c3c; }

        /* Barra rentabilidad */
        .rentabilidad-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 3px;
            margin-top: 16px;
            overflow: hidden;
        }
        .rentabilidad-bar .fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .rentabilidad-bar .fill.positivo { background: linear-gradient(90deg, #2ecc71, #27ae60); }
        .rentabilidad-bar .fill.neutro { background: linear-gradient(90deg, #f39c12, #e67e22); }
        .rentabilidad-bar .fill.negativo { background: linear-gradient(90deg, #e74c3c, #c0392b); }

        /* ===== MODAL EDITAR ===== */
        .modal-overlay-editar {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            display: none;
            justify-content: center;
            align-items: flex-start;
            z-index: 10000;
            overflow-y: auto;
            padding: 30px 0;
        }
        .modal-overlay-editar.active {
            display: flex;
            animation: fadeInDet 0.3s ease-in;
        }
        .modal-editar-body {
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1f4f 100%);
            border: 1px solid rgba(106, 68, 242, 0.3);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 95%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 60px rgba(106, 68, 242, 0.2);
            animation: slideUpDet 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            color: white;
            position: relative;
            margin: auto;
        }
        .modal-editar-body .close-btn {
            position: absolute;
            top: 12px; right: 18px;
            background: none; border: none;
            color: #bbb; font-size: 22px;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-editar-body .close-btn:hover { color: #fff; }
        .modal-editar-body h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(106, 68, 242, 0.25);
            color: #fff;
        }

        /* Form dentro del modal */
        .edit-form .edit-group {
            margin-bottom: 16px;
        }
        .edit-form .edit-label {
            display: block;
            color: #B5B3F2;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 6px;
        }
        .edit-form .edit-input,
        .edit-form .edit-select,
        .edit-form .edit-textarea {
            width: 100%;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(106, 68, 242, 0.25);
            border-radius: 8px;
            padding: 10px 14px;
            color: #d4d0f0;
            font-size: 14px;
            transition: border-color 0.2s;
            outline: none;
            box-sizing: border-box;
        }
        .edit-form .edit-textarea {
            min-height: 80px;
            resize: vertical;
        }
        .edit-form .edit-input:focus,
        .edit-form .edit-select:focus,
        .edit-form .edit-textarea:focus {
            border-color: #6A44F2;
            box-shadow: 0 0 0 2px rgba(106, 68, 242, 0.15);
        }
        .edit-form .edit-input::placeholder { color: #666; }
        .edit-form .edit-select option {
            background: #1a1f3a;
            color: #d4d0f0;
        }
        .edit-form .edit-input[type="file"] {
            padding: 8px 10px;
        }
        .edit-form .edit-input[type="file"]::file-selector-button {
            background: linear-gradient(135deg, #6A44F2, #3C308C);
            border: none;
            color: #fff;
            padding: 5px 14px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.2s;
        }
        .edit-form .edit-input[type="file"]::file-selector-button:hover {
            box-shadow: 0 4px 12px rgba(106, 68, 242, 0.3);
        }

        /* Secci√≥n econ√≥mica */
        .edit-seccion-titulo {
            font-size: 13px;
            font-weight: 700;
            color: #8b82d4;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 20px 0 8px;
            padding-top: 16px;
            border-top: 1px solid rgba(106, 68, 242, 0.15);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .edit-aviso-contable {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.25);
            border-radius: 8px;
            padding: 10px 14px;
            margin-bottom: 16px;
        }
        .edit-aviso-contable .aviso-icon {
            font-size: 18px;
            flex-shrink: 0;
        }
        .edit-aviso-contable .aviso-text {
            color: #f39c12;
            font-size: 12px;
            font-weight: 600;
            line-height: 1.4;
        }

        /* Calculadora visual */
        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }
        .calc-item {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(106, 68, 242, 0.12);
            border-radius: 8px;
            padding: 10px 14px;
            text-align: center;
        }
        .calc-item .calc-label {
            font-size: 10px;
            color: #8b82d4;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .calc-item .calc-value {
            font-size: 16px;
            font-weight: 800;
            color: #fff;
        }
        .calc-item .calc-value.positivo { color: #2ecc71; }
        .calc-item .calc-value.neutro { color: #f39c12; }
        .calc-item .calc-value.negativo { color: #e74c3c; }

        /* Botones del modal editar */
        .edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 24px;
            justify-content: flex-end;
        }
        .edit-btn {
            padding: 9px 22px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .edit-btn.btn-cancelar {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #bbb;
        }
        .edit-btn.btn-cancelar:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }
        .edit-btn.btn-guardar {
            background: linear-gradient(135deg, #6A44F2, #3C308C);
            color: #fff;
            box-shadow: 0 4px 15px rgba(106, 68, 242, 0.25);
        }
        .edit-btn.btn-guardar:hover {
            box-shadow: 0 8px 25px rgba(106, 68, 242, 0.4);
            transform: translateY(-1px);
        }

        /* ===== MODAL ELIMINAR (dark override) ===== */
        #modal-confirm-eliminar .modal-content {
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1f4f 100%) !important;
            border: 1px solid rgba(106, 68, 242, 0.3) !important;
            border-radius: 16px !important;
            color: #d4d0f0 !important;
        }
        #modal-confirm-eliminar .modal-icon { font-size: 40px; margin-bottom: 10px; }
        #modal-confirm-eliminar .modal-title { color: #fff !important; }
        #modal-confirm-eliminar .modal-description { color: #bbb !important; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 992px) {
            .gestion-productos-panel { padding: 20px 16px !important; }
            .gestion-productos-panel .table thead th,
            .gestion-productos-panel .table tbody td {
                padding: 10px 8px !important;
                font-size: 12px;
            }
            .stats-row { gap: 8px; }
            .stat-card { min-width: 100px; padding: 12px 10px; }
            .stat-card .stat-num { font-size: 20px; }
            .busqueda-inline input { width: 140px; }
            .busqueda-inline input:focus { width: 180px; }
        }
    </style>
</head>

<body>
    <!-- MODAL DE CONFIRMACI√ìN PARA ELIMINAR PRODUCTO -->
    <div id="modal-confirm-eliminar" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <h2 class="modal-title">Eliminar Producto</h2>
            <p class="modal-description">¬øEst√°s seguro de que deseas eliminar este producto? Esta acci√≥n no se puede deshacer.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="cancelarEliminar()">Cancelar</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmarEliminar()">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- MODAL DETALLE DEL PRODUCTO -->
    <div class="modal-overlay-detalle" id="modalDetalle" onclick="if(event.target===this)cerrarDetalle()">
        <div class="modal-detalle-body">
            <button class="close-btn" onclick="cerrarDetalle()">&times;</button>
            <h3 id="detalleTitulo">üìä Detalle del Producto</h3>
            <div id="detalleContenido"></div>
        </div>
    </div>

    <!-- MODAL EDITAR PRODUCTO -->
    <div class="modal-overlay-editar" id="modalEditar" onclick="if(event.target===this)cerrarEditar()">
        <div class="modal-editar-body">
            <button class="close-btn" onclick="cerrarEditar()">&times;</button>
            <h3>‚úèÔ∏è Editar Producto</h3>

            <form id="formEditar" class="edit-form" method="POST" enctype="multipart/form-data">
                <!-- Campos editables -->
                <div class="edit-group">
                    <label class="edit-label">Nombre</label>
                    <input type="text" name="nombre" id="editNombre" class="edit-input" required>
                </div>
                <div class="edit-group">
                    <label class="edit-label">Descripci√≥n</label>
                    <textarea name="descripcion" id="editDescripcion" class="edit-textarea"></textarea>
                </div>
                <div class="edit-group">
                    <label class="edit-label">Categor√≠a</label>
                    <select name="categoria" id="editCategoria" class="edit-select">
                        <option value="Teclados">Teclados</option>
                        <option value="Mouse">Mouse</option>
                        <option value="Audio">Audio</option>
                        <option value="Joysticks">Joysticks</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                <div class="edit-group">
                    <label class="edit-label">Precio de venta</label>
                    <input type="text" name="precio" id="editPrecio" class="edit-input" required>
                </div>
                <div class="edit-group">
                    <label class="edit-label">Imagen (opcional, reemplaza la actual)</label>
                    <input type="file" name="foto" id="editFoto" class="edit-input" accept="image/*">
                </div>

                <!-- Secci√≥n econ√≥mica -->
                <div class="edit-seccion-titulo">üí∞ Campos Econ√≥micos (correcci√≥n)</div>
                <div class="edit-aviso-contable">
                    <span class="aviso-icon">‚ö†Ô∏è</span>
                    <span class="aviso-text">Editar estos campos es una correcci√≥n administrativa. No genera movimientos contables, egresos ni recalcula estad√≠sticas.</span>
                </div>
                <div class="edit-group">
                    <label class="edit-label">Costo unitario</label>
                    <input type="text" name="costo" id="editCosto" class="edit-input" placeholder="Costo real del producto">
                </div>
                <div class="edit-group">
                    <label class="edit-label">Cantidad (stock)</label>
                    <input type="number" name="cantidad" id="editCantidad" class="edit-input" min="0">
                </div>

                <!-- Calculadora visual (solo informativa) -->
                <div class="edit-seccion-titulo">üßÆ Calculadora (solo visual)</div>
                <div class="edit-group">
                    <label class="edit-label">% Ganancia deseado</label>
                    <input type="number" id="editPctGanancia" class="edit-input" min="0" step="0.01" value="30" placeholder="Ej: 30">
                </div>
                <div class="calc-grid" id="editCalcGrid">
                    <div class="calc-item">
                        <div class="calc-label">Inversi√≥n Total</div>
                        <div class="calc-value" id="calcInversion">$0</div>
                    </div>
                    <div class="calc-item">
                        <div class="calc-label">Precio Sugerido</div>
                        <div class="calc-value" id="calcPrecioSugerido">$0</div>
                    </div>
                    <div class="calc-item">
                        <div class="calc-label">Ganancia / Unidad</div>
                        <div class="calc-value" id="calcGananciaUnit">$0</div>
                    </div>
                    <div class="calc-item">
                        <div class="calc-label">Rentabilidad</div>
                        <div class="calc-value" id="calcRentabilidad">‚Äî</div>
                    </div>
                </div>

                <div class="edit-actions">
                    <button type="button" class="edit-btn btn-cancelar" onclick="cerrarEditar()">Cancelar</button>
                    <button type="submit" class="edit-btn btn-guardar">üíæ Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <header>
        {% include 'navbar.html' %}
    </header>

    <main>
        <div class="form-container table-container gestion-productos-panel">

        <h1 class="my-4">Gesti√≥n de Productos</h1>

        <!-- STATS R√ÅPIDOS -->
        <div class="stats-row" id="statsRow">
            <div class="stat-card">
                <div class="stat-num" id="statTotal">0</div>
                <div class="stat-label">Productos</div>
            </div>
            <div class="stat-card stock-ok">
                <div class="stat-num" id="statEnStock">0</div>
                <div class="stat-label">En Stock</div>
            </div>
            <div class="stat-card stock-bajo">
                <div class="stat-num" id="statBajoStock">0</div>
                <div class="stat-label">Bajo Stock</div>
            </div>
            <div class="stat-card stock-agotado">
                <div class="stat-num" id="statAgotado">0</div>
                <div class="stat-label">Agotados</div>
            </div>
        </div>

        <!-- FILTROS + BUSCADOR -->
        <div class="filtros-bar-prod">
            <span class="filtro-label">üîç Filtrar:</span>
            <button class="filtro-chip-prod active" onclick="filtrarProd('todos', this)">Todos <span class="chip-count" id="fTotal">0</span></button>
            <button class="filtro-chip-prod" onclick="filtrarProd('en-stock', this)">En stock <span class="chip-count" id="fEnStock">0</span></button>
            <button class="filtro-chip-prod" onclick="filtrarProd('bajo-stock', this)">Bajo stock <span class="chip-count" id="fBajo">0</span></button>
            <button class="filtro-chip-prod" onclick="filtrarProd('agotado', this)">Agotados <span class="chip-count" id="fAgotado">0</span></button>
            <div class="busqueda-inline">
                <input type="text" id="buscadorProd" placeholder="Buscar producto..." oninput="buscarProd(this.value)">
            </div>
        </div>

        <a href="/formulario" class="btn-agregar-prod">
            <img src="/static/images/agregar.png" alt="Agregar">
            Agregar producto
        </a>

        <div class="filtros-sin-resultados-prod" id="sinResultadosProd">No se encontraron productos con este filtro.</div>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Descripci√≥n</th>
                    <th>Categor√≠a</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody id="tablaProductosBody">
                {% for p in productos %}
                <tr data-prod-id="{{ p[0] }}"
                    data-nombre="{{ p[1] }}"
                    data-descripcion="{{ p[2]|e }}"
                    data-categoria="{{ p[3] }}"
                    data-precio="{{ p[4] }}"
                    data-costo="{{ p[7] }}"
                    data-cantidad="{{ p[5] }}"
                    data-stock-status="{{ 'agotado' if p[5] == 0 else ('bajo-stock' if p[5] <= 5 else 'en-stock') }}">
                    <td style="color:#8b82d4; font-weight:600;">#{{ p[0] }}</td>
                    <td class="prod-nombre">{{ p[1] }}</td>
                    <td class="descripcion">
                        <span class="descripcion-texto">
                            {{ p[2]|safe }}
                        </span>
                    </td>
                    <td><span class="badge-cat">{{ p[3] }}</span></td>
                    <td class="precio-cell">{{ p[4] }}</td>
                    <td>
                        {% if p[5] == 0 %}
                            <span class="badge-stock agotado"><span class="stock-dot"></span> Agotado</span>
                        {% elif p[5] <= 5 %}
                            <span class="badge-stock bajo-stock"><span class="stock-dot"></span> {{ p[5] }} uds</span>
                        {% else %}
                            <span class="badge-stock en-stock"><span class="stock-dot"></span> {{ p[5] }} uds</span>
                        {% endif %}
                    </td>

                    <td>
                        <div class="acciones-prod">
                            <button class="btn-acc acc-detalle" onclick="verDetalle(this.closest('tr'))">
                                üìä Detalle
                            </button>
                            <button class="btn-acc acc-editar" onclick="abrirEditar(this.closest('tr'))">
                                <img src="/static/images/modificar.png" alt="Editar">
                                Editar
                            </button>
                            <a class="btn-acc acc-eliminar" onclick="mostrarModalEliminar({{ p[0] }});" style="cursor: pointer;">
                                <img src="/static/images/eliminar.png" alt="Eliminar">
                                Eliminar
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    </main>
    
    <script>
        let productoAEliminar = null;

        function mostrarNotificacion(mensaje, esError = false) {
            const notif = document.createElement('div');
            notif.className = 'notificacion' + (esError ? ' error' : '');
            notif.textContent = mensaje;
            document.body.appendChild(notif);
            setTimeout(() => {
                notif.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }
        
        function mostrarModalEliminar(productoId) {
            productoAEliminar = productoId;
            const modal = document.getElementById('modal-confirm-eliminar');
            modal.classList.add('active');
        }
        
        function cancelarEliminar() {
            const modal = document.getElementById('modal-confirm-eliminar');
            modal.classList.remove('active');
            productoAEliminar = null;
        }
        
        function confirmarEliminar() {
            if (productoAEliminar) {
                window.location.href = '/eliminar_producto/' + productoAEliminar;
            }
        }

        // Cerrar modal al hacer clic fuera del contenido
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('modal-confirm-eliminar');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    cancelarEliminar();
                }
            });
        });

        // ===== STATS & CONTADORES =====
        function calcularStats() {
            const filas = document.querySelectorAll('#tablaProductosBody tr[data-prod-id]');
            let total = 0, enStock = 0, bajo = 0, agotado = 0;
            filas.forEach(f => {
                total++;
                const st = f.getAttribute('data-stock-status');
                if (st === 'en-stock') enStock++;
                else if (st === 'bajo-stock') bajo++;
                else agotado++;
            });
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statEnStock').textContent = enStock;
            document.getElementById('statBajoStock').textContent = bajo;
            document.getElementById('statAgotado').textContent = agotado;
            document.getElementById('fTotal').textContent = total;
            document.getElementById('fEnStock').textContent = enStock;
            document.getElementById('fBajo').textContent = bajo;
            document.getElementById('fAgotado').textContent = agotado;
        }
        calcularStats();

        // ===== FILTROS =====
        let filtroActualProd = 'todos';
        let busquedaActualProd = '';

        function filtrarProd(tipo, btnEl) {
            filtroActualProd = tipo;
            document.querySelectorAll('.filtro-chip-prod').forEach(c => c.classList.remove('active'));
            btnEl.classList.add('active');
            aplicarFiltrosCombinados();
        }

        function buscarProd(term) {
            busquedaActualProd = term.toLowerCase().trim();
            aplicarFiltrosCombinados();
        }

        function aplicarFiltrosCombinados() {
            const filas = document.querySelectorAll('#tablaProductosBody tr[data-prod-id]');
            let visibles = 0;
            filas.forEach(f => {
                const st = f.getAttribute('data-stock-status');
                const nombre = (f.getAttribute('data-nombre') || '').toLowerCase();
                let pasa = true;

                // Filtro de stock
                if (filtroActualProd !== 'todos' && st !== filtroActualProd) pasa = false;
                // Filtro de b√∫squeda
                if (busquedaActualProd && !nombre.includes(busquedaActualProd)) pasa = false;

                f.style.display = pasa ? '' : 'none';
                if (pasa) visibles++;
            });
            document.getElementById('sinResultadosProd').style.display = visibles === 0 ? 'block' : 'none';
        }

        // ===== MODAL DETALLE =====
        function verDetalle(fila) {
            const nombre = fila.getAttribute('data-nombre');
            const precio = parseFloat(fila.getAttribute('data-precio')) || 0;
            const costo = parseFloat(fila.getAttribute('data-costo')) || 0;
            const cantidad = parseInt(fila.getAttribute('data-cantidad')) || 0;

            const inversionTotal = costo * cantidad;
            const gananciaUnit = precio - costo;
            let pctGanancia = 0;
            if (costo > 0) {
                pctGanancia = ((precio - costo) / costo * 100);
            } else if (precio > 0) {
                pctGanancia = 100;
            }

            // Clasificar rentabilidad
            let claseRent = 'neutro';
            let textoRent = '‚öñÔ∏è Neutro';
            if (pctGanancia > 15) { claseRent = 'positivo'; textoRent = 'üìà Positivo'; }
            else if (pctGanancia < 0) { claseRent = 'negativo'; textoRent = 'üìâ Negativo'; }

            // Barra visual (cap a 100%)
            const barWidth = Math.min(Math.abs(pctGanancia), 100);

            document.getElementById('detalleTitulo').textContent = 'üìä ' + nombre;
            document.getElementById('detalleContenido').innerHTML = `
                <div class="det-row">
                    <span class="det-label">üí∞ Costo unitario</span>
                    <span class="det-value">$${costo.toLocaleString('es-AR')}</span>
                </div>
                <div class="det-row">
                    <span class="det-label">üè∑Ô∏è Precio de venta</span>
                    <span class="det-value">$${precio.toLocaleString('es-AR')}</span>
                </div>
                <div class="det-row">
                    <span class="det-label">üì¶ Stock actual</span>
                    <span class="det-value">${cantidad} unidades</span>
                </div>
                <div class="det-row">
                    <span class="det-label">üíµ Inversi√≥n total</span>
                    <span class="det-value">$${inversionTotal.toLocaleString('es-AR')}</span>
                </div>
                <div class="det-row">
                    <span class="det-label">üìä Ganancia por unidad</span>
                    <span class="det-value ${claseRent}">$${gananciaUnit.toLocaleString('es-AR')}</span>
                </div>
                <div class="det-row">
                    <span class="det-label">üìà Porcentaje de ganancia</span>
                    <span class="det-value ${claseRent}">${pctGanancia.toFixed(1)}%</span>
                </div>
                <div class="det-row">
                    <span class="det-label">üéØ Rentabilidad</span>
                    <span class="det-value ${claseRent}">${textoRent}</span>
                </div>
                <div class="rentabilidad-bar">
                    <div class="fill ${claseRent}" style="width: ${barWidth}%"></div>
                </div>
            `;

            document.getElementById('modalDetalle').classList.add('active');
        }

        function cerrarDetalle() {
            document.getElementById('modalDetalle').classList.remove('active');
        }

        // ===== MODAL EDITAR =====
        let editProductoId = null;

        function abrirEditar(fila) {
            editProductoId = fila.getAttribute('data-prod-id');
            const nombre = fila.getAttribute('data-nombre') || '';
            const descripcion = fila.getAttribute('data-descripcion') || '';
            const categoria = fila.getAttribute('data-categoria') || 'Otros';
            const precio = fila.getAttribute('data-precio') || '0';
            const costo = fila.getAttribute('data-costo') || '0';
            const cantidad = fila.getAttribute('data-cantidad') || '0';

            document.getElementById('editNombre').value = nombre;
            document.getElementById('editDescripcion').value = descripcion;
            document.getElementById('editCategoria').value = categoria;
            document.getElementById('editPrecio').value = precio;
            document.getElementById('editCosto').value = costo;
            document.getElementById('editCantidad').value = cantidad;
            document.getElementById('editFoto').value = '';
            document.getElementById('editPctGanancia').value = 30;

            // Setear action del form
            document.getElementById('formEditar').action = '/actualizar_producto/' + editProductoId;

            // Calcular
            recalcularEditar();

            document.getElementById('modalEditar').classList.add('active');
        }

        function cerrarEditar() {
            document.getElementById('modalEditar').classList.remove('active');
            editProductoId = null;
        }

        function recalcularEditar() {
            const costo = parseFloat(document.getElementById('editCosto').value) || 0;
            const cantidad = parseInt(document.getElementById('editCantidad').value) || 0;
            const precio = parseFloat(document.getElementById('editPrecio').value) || 0;
            const pctDeseado = parseFloat(document.getElementById('editPctGanancia').value) || 0;

            const inversion = costo * cantidad;
            const precioSugerido = costo > 0 ? costo * (1 + pctDeseado / 100) : 0;
            const gananciaUnit = precio - costo;
            let pctReal = 0;
            if (costo > 0) pctReal = ((precio - costo) / costo) * 100;
            else if (precio > 0) pctReal = 100;

            let claseRent = 'neutro';
            let textoRent = '‚öñÔ∏è Neutro';
            if (pctReal > 15) { claseRent = 'positivo'; textoRent = 'üìà Positivo'; }
            else if (pctReal < 0) { claseRent = 'negativo'; textoRent = 'üìâ Negativo'; }

            document.getElementById('calcInversion').textContent = '$' + inversion.toLocaleString('es-AR');
            document.getElementById('calcPrecioSugerido').textContent = '$' + Math.round(precioSugerido).toLocaleString('es-AR');

            const gananciaEl = document.getElementById('calcGananciaUnit');
            gananciaEl.textContent = '$' + gananciaUnit.toLocaleString('es-AR');
            gananciaEl.className = 'calc-value ' + claseRent;

            const rentEl = document.getElementById('calcRentabilidad');
            rentEl.textContent = textoRent + ' (' + pctReal.toFixed(1) + '%)';
            rentEl.className = 'calc-value ' + claseRent;
        }

        // Listeners para recalcular en vivo
        ['editCosto', 'editCantidad', 'editPrecio', 'editPctGanancia'].forEach(id => {
            document.getElementById(id).addEventListener('input', recalcularEditar);
        });

        // Submit del form de edici√≥n
        document.getElementById('formEditar').addEventListener('submit', function(e) {
            e.preventDefault();
            const form = this;
            const formData = new FormData(form);

            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok || response.redirected) {
                    mostrarNotificacion('‚úì Producto actualizado correctamente');
                    setTimeout(() => location.reload(), 1200);
                } else {
                    mostrarNotificacion('‚ùå Error al actualizar el producto', true);
                }
            })
            .catch(() => {
                mostrarNotificacion('‚ùå Error de red al guardar', true);
            });
        });
    </script>
    
    {% include 'footer.html' %}
</body>
</html>
