<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FullGaming</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo_solo.png') }}">
    <!--Estilo CSS-->
    <link rel="stylesheet"  href="{{ url_for('static', filename='css/index.css') }}">
    <!-- Vinculacion con Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Scripts de Bootstrap y jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <!-- MODAL DE CONFIRMACIÓN PARA ELIMINAR PRODUCTO -->
    <div id="modal-confirm-eliminar" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">⚠️</div>
            <h2 class="modal-title">Eliminar Producto</h2>
            <p class="modal-description">¿Estás seguro de que deseas eliminar este producto? Esta acción no se puede deshacer.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="cancelarEliminar()">Cancelar</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmarEliminar()">Eliminar</button>
            </div>
        </div>
    </div>
    <header>
        {% include 'navbar.html' %}  <!-- incluye el navabar.html-->
    </header>

    <main>
        <div class="form-container table-container">

        <h1 class="my-4">Gestión de Productos</h1>
        <a href="/formulario" class="btn-agregar-producto">
        <img src="/static/images/agregar.png" alt="Agregar">
        Agregar producto
        </a>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Categoría</th>
                    <th>Precio</th>
                    <th>Cantidad</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                {% for p in productos %}
                <tr>
                    <td>{{ p[0] }}</td>
                    <td>{{ p[1] }}</td>
                    <td class="descripcion">
                        <span class="descripcion-texto">
                            {{ p[2]|safe }}
                        </span>
                    </td>
                    <td>{{ p[3] }}</td>
                    <td>{{ p[4] }}</td>
                    <td>{{ p[5] }}</td>

                    <td>
                        <div class="acciones-btns">
                            <a class="btn-editar" href="/editar_producto/{{ p[0] }}">
                                <img src="/static/images/modificar.png" alt="Editar">
                                Editar
                            </a>

                            <a class="btn-eliminar" onclick="mostrarModalEliminar({{ p[0] }});" style="cursor: pointer;">
                                <img src="/static/images/eliminar.png" alt="Eliminar">
                                Eliminar
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    </main>
    
    <script>
        let productoAEliminar = null;

        function mostrarNotificacion(mensaje, esError = false) {
            const notif = document.createElement('div');
            notif.className = 'notificacion' + (esError ? ' error' : '');
            notif.textContent = mensaje;
            document.body.appendChild(notif);
            setTimeout(() => {
                notif.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }
        
        function mostrarModalEliminar(productoId) {
            productoAEliminar = productoId;
            const modal = document.getElementById('modal-confirm-eliminar');
            modal.classList.add('active');
        }
        
        function cancelarEliminar() {
            const modal = document.getElementById('modal-confirm-eliminar');
            modal.classList.remove('active');
            productoAEliminar = null;
        }
        
        function confirmarEliminar() {
            if (productoAEliminar) {
                window.location.href = '/eliminar_producto/' + productoAEliminar;
            }
        }

        // Cerrar modal al hacer clic fuera del contenido
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('modal-confirm-eliminar');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    cancelarEliminar();
                }
            });
        });
    </script>
    
    {% include 'footer.html' %}
</body>
</html>
