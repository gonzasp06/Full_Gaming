<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FullGaming</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo_solo.png') }}">
    <!--Estilo CSS-->
    <link rel="stylesheet"  href="{{ url_for('static', filename='style.css') }}">
    <!-- Vinculacion con Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Scripts de Bootstrap y jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    {% include 'navbar.html' %} <!--incluye el navabar.html-->

    <div class="producto-detalle-container">
        <div class="row g-4">
            <!-- FOTO GRANDE -->
            <div class="col-md-5">
                <div class="producto-detalle-imagen">
                    {% set foto = producto[6] | replace('\\', '/') if producto[6] else '' %}
                    {% if foto and foto.startswith('static/') %}
                        <img src="{{ url_for('static', filename=foto.split('static/')[1]) }}" alt="{{ producto[1] }}">
                    {% elif foto and foto.startswith('/') %}
                        <img src="{{ foto }}" alt="{{ producto[1] }}">
                    {% elif foto %}
                        <img src="/{{ foto }}" alt="{{ producto[1] }}">
                    {% else %}
                        <img src="{{ url_for('static', filename='images/no-image.png') }}" alt="Sin imagen disponible">
                    {% endif %}
                </div>
            </div>
            
            <!-- INFO PRINCIPAL -->
            <div class="col-md-7">
                <h1 class="producto-detalle-titulo">{{ producto[1] }}</h1>

                <p class="producto-detalle-categoria">
                    Categoría: <span>{{ producto[3] }}</span>
                </p>

                <p class="producto-detalle-precio">
                    ${{ producto[4] }}
                </p>

                <p class="producto-detalle-stock">
                    Stock disponible: <span>{{ producto[5] }}</span>
                </p>

                <!-- Botón agregar al carrito -->
                <button id="btn-agregar-{{ producto[0] }}" class="btn-comprar {% if producto[5] == 0 %}disabled{% endif %}"
                data-nombre="{{ producto[1] }}"
                onclick="agregarAlCarrito({{ producto[0] }}, 'btn-agregar-{{ producto[0] }}')"
                {% if producto[5] == 0 %}disabled{% endif %}>
                {% if producto[5] > 0 %}Agregar al carrito{% else %}Sin stock{% endif %}
                </button>
            </div>
        </div>

        <!-- DESCRIPCIÓN LARGA ABAJO -->
        <div class="producto-detalle-descripcion">
            <h2>Descripción</h2>
            <p>{{ producto[2] }}</p>
        </div>
    </div>

    <script>
    function agregarAlCarrito(productoId, btnId) {
        const btn = document.getElementById(btnId);
        const nombre = btn ? btn.dataset.nombre : '';
        if (btn) btn.disabled = true;

        fetch(`/agregar_carrito/${productoId}`, {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ cantidad: 1 })
        })
        .then(response => response.json().then(data => ({ ok: response.ok, data })))
        .then(result => {
            if (result.ok && result.data.ok) {
                alert((nombre || 'Producto') + ' agregado al carrito');
            } else {
                alert('Error: ' + (result.data.error || 'No se pudo agregar al carrito'));
            }
        })
        .catch(err => {
            console.error('Error al agregar al carrito:', err);
            alert('Error de red al agregar al carrito');
        })
        .finally(() => { if (btn) btn.disabled = false; });
    }
    </script>
    {% include 'footer.html' %} 
</body>
</html>